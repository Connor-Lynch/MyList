{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { map, switchMap, takeUntil, tap } from 'rxjs/operators';\nimport { AppRoutes } from 'src/app/models/app-routes';\nimport { ShoppingListFormFields } from './models/shopping-list-form-fields';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"src/app/services/shopping-list.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"../../components/back-button/back-button.component\";\nimport * as i6 from \"./components/list-name/list-name.component\";\nimport * as i7 from \"./components/items/items.component\";\nfunction ShoppingListPage_form_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"form\", 2);\n    i0.ɵɵelement(1, \"app-list-name\", 3)(2, \"app-items\", 3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.formGroup);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControlName\", ctx_r0.formFields.Name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formControlName\", ctx_r0.formFields.Items);\n  }\n}\nexport let ShoppingListPage = /*#__PURE__*/(() => {\n  class ShoppingListPage {\n    constructor(activatedRoute, formBuilder, shoppingListService) {\n      this.activatedRoute = activatedRoute;\n      this.formBuilder = formBuilder;\n      this.shoppingListService = shoppingListService;\n      this.formFields = ShoppingListFormFields;\n      this.destroy$ = new Subject();\n    }\n    ngOnInit() {\n      this.formGroup = this.formBuilder.group({\n        [ShoppingListFormFields.Name]: [],\n        [ShoppingListFormFields.Items]: []\n      });\n      const shoppingListId = this.activatedRoute.snapshot.paramMap.get(AppRoutes.shoppingList.data);\n      this.initShoppingList(shoppingListId);\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n    initShoppingList(id) {\n      this.shoppingListService.getShoppingListById(id).pipe(tap(shoppingList => this.shoppingList = shoppingList), tap(() => this.initFormGroup()), takeUntil(this.destroy$)).subscribe();\n    }\n    initFormGroup() {\n      this.formGroup.controls[ShoppingListFormFields.Name].setValue(this.shoppingList.name);\n      this.formGroup.controls[ShoppingListFormFields.Items].setValue(this.shoppingList.items);\n      this.formGroup.controls[ShoppingListFormFields.Name].valueChanges.pipe(switchMap(() => this.updateShoppingList()), takeUntil(this.destroy$)).subscribe();\n    }\n    updateShoppingList() {\n      const updatedList = this.getUpdatedShoppingList();\n      return this.shoppingListService.updateShoppingList(updatedList).pipe(tap(() => this.shoppingList = updatedList), map(() => null));\n    }\n    getUpdatedShoppingList() {\n      return {\n        ...this.shoppingList,\n        name: this.formGroup.controls[ShoppingListFormFields.Name].value,\n        items: this.formGroup.controls[ShoppingListFormFields.Items].value\n      };\n    }\n    static #_ = this.ɵfac = function ShoppingListPage_Factory(t) {\n      return new (t || ShoppingListPage)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.ShoppingListService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ShoppingListPage,\n      selectors: [[\"app-shopping-list\"]],\n      decls: 2,\n      vars: 1,\n      consts: [[1, \"m-3\"], [\"class\", \"m-3 mt-0 p-3 pt-0\", 3, \"formGroup\", 4, \"ngIf\"], [1, \"m-3\", \"mt-0\", \"p-3\", \"pt-0\", 3, \"formGroup\"], [3, \"formControlName\"]],\n      template: function ShoppingListPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelement(0, \"app-back-button\", 0);\n          i0.ɵɵtemplate(1, ShoppingListPage_form_1_Template, 3, 3, \"form\", 1);\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.shoppingList);\n        }\n      },\n      dependencies: [i4.NgIf, i2.ɵNgNoValidate, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, i5.BackButtonComponent, i6.ListNameComponent, i7.ItemsComponent]\n    });\n  }\n  return ShoppingListPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}